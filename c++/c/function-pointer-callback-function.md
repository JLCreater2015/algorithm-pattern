# 函数指针与回调函数

## ✏ 1、指针函数

 **指针函数：** 本质是一个函数，不过它的返回值是一个指针。其声明的形式如下所示：

```cpp
ret *func(args, ...);
```

指针函数和普通函数没有区别，但有一点需要注意的是： **避免出现返回局部变量指针的情况。**看例子：

```cpp
int* getSum(int n)
{
    if (n < 0)
        return NULL;
    int sum = 0;   // static int sum = 0;
    for (int i = 0; i < n; i++)
    {
        sum += i;
    }
    return &sum;
}

int main() {
    cout << *getSum(10) << endl;
    cout << "Wait for a while...\n" << endl;
    int* iptr = getSum(10);
    cout << *iptr << endl;
    return 0;
}
```

在GCC编译器下没有输出，也就是说程序运行到第14行就强行退出了，原因在于，一般的局部变量是存放于栈区的，当函数结束，栈区的变量就会释放掉，如果我们在函数内部定义一个变量，在使用一个指针去指向这个变量，当函数调用结束时，这个变量的空间就已经被释放，这时就算返回了该地址的指针，也不一定会得到正确的值。并且该地址可能会被后面的程序所使用，这时候得到的就不是我们想要的结果。甚至更严重的是，如果因此访问到了不可访问的内容，很有可能造成段错误等程序崩溃的情况。（需要说明的是该程序在VC++编译器下可以正常运行，这与编译器的优化有关，但不符合C语言的特性）

解决方法，将局部变量sum声明成static int， 用`static`修饰的变量是静态变量，而静态变量是存放在数据段的，它的生命周期存在于整个程序运行期间，只要程序没有结束，该变量就会一直存在，所以该指针就能一直访问到该变量。还有一种解决方案是使用全局变量，因为全局变量也是放在数据段的，但是并不推荐使用全局变量。

